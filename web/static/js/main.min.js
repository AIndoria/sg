function updateUrlParameter(e,t,a){var n=e.indexOf("#"),i=-1===n?"":e.substr(n);e=-1===n?e:e.substr(0,n);var r=new RegExp("([?&])"+t+"=.*?(&|$)","i"),s=-1!==e.indexOf("?")?"&":"?";return a?e=e.match(r)?e.replace(r,"$1"+t+"="+a+"$2"):e+s+t+"="+a:("?"===(e=e.replace(new RegExp("([?&]?)"+t+"=[^&]*","i"),"")).slice(-1)&&(e=e.slice(0,-1)),-1===e.indexOf("?")&&(e=e.replace(/&/,"?"))),e+i}function debounce(e,t,a){var n;return function(){var i=this,r=arguments,s=a&&!n;clearTimeout(n),n=setTimeout(function(){n=null,a||e.apply(i,r)},t),s&&e.apply(i,r)}}function showNFO(e,t){var a=document.querySelector("#modal-nfo + .modal .modal__inner"),n=document.querySelector("#modal-nfo + .modal pre");switch(document.getElementById("modal-nfo").checked=!0,n.innerHTML="",n.style.fontSize=null,t){case"desktop":http.get({url:"/nfo/",data:{release:e}},function(e){var t=JSON.parse(e).MSG.replace(/[^\S\r\n]+$/gm,"");t=(t=t.split(/\r?\n/)).map(function(e){return e.slice(-length)}),n.innerHTML=t.join("\n")});break;case"mobile":http.get({url:"/nfo/",data:{release:e}},function(e){var t=JSON.parse(e).MSG.replace(/[^\S\r\n]+$/gm,""),i=(t=t.split(/\r?\n/)).map(function(e){return e.trim()}).sort(function(e,t){return t.length-e.length})[0].length,r=(a.offsetWidth-6)/i*2;n.style.fontSize=Math.round(100*r)/100+"px",n.innerHTML=t.join("\n")})}toggleScroll()}function toggleSearch(){"show"===searchResults.classList.value?(searchResults.classList.remove("show"),document.getElementById("darken").classList.remove("on")):(searchResults.classList.add("show"),document.getElementById("darken").classList.add("on"))}function toggleScroll(){"no-scroll"===document.body.classList[0]?document.body.classList.remove("no-scroll"):document.body.classList.add("no-scroll")}function showNFOMobile(e){var t=e.parentNode.parentNode.querySelector(".nfo-container"),a=t.getElementsByTagName("pre")[0];t.classList.contains("hidden")?(t.classList.remove("hidden"),http.get({url:"/nfo/",data:{release:e.dataset.nfomobile}},function(e){var n=JSON.parse(e).MSG.replace(/[^\S\r\n]+$/gm,""),i=(n=n.split(/\r?\n/)).map(function(e){return e.trim()}).sort(function(e,t){return t.length-e.length})[0].length,r=(t.offsetWidth-6)/i*2;a.style.fontSize=Math.round(100*r)/100+"px",a.innerHTML=n.join("\n")})):t.classList.add("hidden")}if("objectFit"in document.documentElement.style==!1){var objeftFitElements=document.getElementsByClassName("__object-fit-poly");if(objeftFitElements.length>0)for(i=0;i<objeftFitElements.length;i++){var imageUrl=objeftFitElements[i].dataset.iefix;objeftFitElements[i].classList.add("__no-object-fill"),objeftFitElements[i].style.backgroundImage="url("+imageUrl+");"}}!function(e,t){"function"==typeof define&&define.amd?define([],t):e.visualCaptcha=t()}(this,function(){var e,t,a;return function(n){function i(e,t){return y.call(e,t)}function r(e,t){var a,n,i,r,s,o,l,c,u,d,m,p=t&&t.split("/"),g=h.map,f=g&&g["*"]||{};if(e&&"."===e.charAt(0))if(t){for(p=p.slice(0,p.length-1),s=(e=e.split("/")).length-1,h.nodeIdCompat&&N.test(e[s])&&(e[s]=e[s].replace(N,"")),e=p.concat(e),u=0;u<e.length;u+=1)if("."===(m=e[u]))e.splice(u,1),u-=1;else if(".."===m){if(1===u&&(".."===e[2]||".."===e[0]))break;u>0&&(e.splice(u-1,2),u-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((p||f)&&g){for(u=(a=e.split("/")).length;u>0;u-=1){if(n=a.slice(0,u).join("/"),p)for(d=p.length;d>0;d-=1)if((i=g[p.slice(0,d).join("/")])&&(i=i[n])){r=i,o=u;break}if(r)break;!l&&f&&f[n]&&(l=f[n],c=u)}!r&&l&&(r=l,o=c),r&&(a.splice(0,o,r),e=a.join("/"))}return e}function s(e,t){return function(){return d.apply(n,b.call(arguments,0).concat([e,t]))}}function o(e){return function(t){g[e]=t}}function l(e){if(i(f,e)){var t=f[e];delete f[e],v[e]=!0,u.apply(n,t)}if(!i(g,e)&&!i(v,e))throw new Error("No "+e);return g[e]}function c(e){var t,a=e?e.indexOf("!"):-1;return a>-1&&(t=e.substring(0,a),e=e.substring(a+1,e.length)),[t,e]}var u,d,m,p,g={},f={},h={},v={},y=Object.prototype.hasOwnProperty,b=[].slice,N=/\.js$/;m=function(e,t){var a,n=c(e),i=n[0];return e=n[1],i&&(a=l(i=r(i,t))),i?e=a&&a.normalize?a.normalize(e,function(e){return function(t){return r(t,e)}}(t)):r(e,t):(i=(n=c(e=r(e,t)))[0],e=n[1],i&&(a=l(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:a}},p={require:function(e){return s(e)},exports:function(e){var t=g[e];return void 0!==t?t:g[e]={}},module:function(e){return{id:e,uri:"",exports:g[e],config:function(e){return function(){return h&&h.config&&h.config[e]||{}}}(e)}}},u=function(e,t,a,r){var c,u,d,h,y,b,N=[],S=typeof a;if(r=r||e,"undefined"===S||"function"===S){for(t=!t.length&&a.length?["require","exports","module"]:t,y=0;y<t.length;y+=1)if(h=m(t[y],r),"require"===(u=h.f))N[y]=p.require(e);else if("exports"===u)N[y]=p.exports(e),b=!0;else if("module"===u)c=N[y]=p.module(e);else if(i(g,u)||i(f,u)||i(v,u))N[y]=l(u);else{if(!h.p)throw new Error(e+" missing "+u);h.p.load(h.n,s(r,!0),o(u),{}),N[y]=g[u]}d=a?a.apply(g[e],N):void 0,e&&(c&&c.exports!==n&&c.exports!==g[e]?g[e]=c.exports:d===n&&b||(g[e]=d))}else e&&(g[e]=a)},e=t=d=function(e,t,a,i,r){if("string"==typeof e)return p[e]?p[e](t):l(m(e,t).f);if(!e.splice){if((h=e).deps&&d(h.deps,h.callback),!t)return;t.splice?(e=t,t=a,a=null):e=n}return t=t||function(){},"function"==typeof a&&(a=i,i=r),i?u(n,e,t,a):setTimeout(function(){u(n,e,t,a)},4),d},d.config=function(e){return d(e)},e._defined=g,(a=function(e,t,a){t.splice||(a=t,t=[]),i(g,e)||i(f,e)||(f[e]=[e,t,a])}).amd={jQuery:!0}}(),a("almond",function(){}),a("visualcaptcha/core",[],function(){"use strict";var e,t,a,n,i,r,s,o;return e=function(e,t,a){return a=a||[],e.namespace&&e.namespace.length>0&&a.push(e.namespaceFieldName+"="+e.namespace),a.push(e.randomParam+"="+e.randomNonce),t+"?"+a.join("&")},t=function(e){var t,n=this;e.applyRandomNonce(),e.isLoading=!0,t=a(e),e._loading(n),e.callbacks.loading&&e.callbacks.loading(n),e.request(t,function(t){t.audioFieldName&&(e.audioFieldName=t.audioFieldName),t.imageFieldName&&(e.imageFieldName=t.imageFieldName),t.imageName&&(e.imageName=t.imageName),t.values&&(e.imageValues=t.values),e.isLoading=!1,e.hasLoaded=!0,e._loaded(n),e.callbacks.loaded&&e.callbacks.loaded(n)})},a=function(t){var a=t.url+t.routes.start+"/"+t.numberOfImages;return e(t,a)},n=function(t,a){var n="",i=[];return a<0||a>=t.numberOfImages?n:(this.isRetina()&&i.push("retina=1"),n=t.url+t.routes.image+"/"+a,e(t,n,i))},i=function(t,a){var n=t.url+t.routes.audio;return a&&(n+="/ogg"),e(t,n)},r=function(e,t){return t>=0&&t<e.numberOfImages?e.imageValues[t]:""},s=function(){return void 0!==window.devicePixelRatio&&window.devicePixelRatio>1},o=function(){return!1},function(e){var a,l,c,u,d,m,p,g,f,h,v,y,b;return l=function(){return t.call(this,e)},c=function(){return e.isLoading},u=function(){return e.hasLoaded},d=function(){return e.imageValues.length},m=function(){return e.imageName},p=function(t){return r.call(this,e,t)},g=function(t){return n.call(this,e,t)},f=function(t){return i.call(this,e,t)},h=function(){return e.imageFieldName},v=function(){return e.audioFieldName},y=function(){return e.namespace},b=function(){return e.namespaceFieldName},a={refresh:l,isLoading:c,hasLoaded:u,numberOfImages:d,imageName:m,imageValue:p,imageUrl:g,audioUrl:f,imageFieldName:h,audioFieldName:v,namespace:y,namespaceFieldName:b,isRetina:s,supportsAudio:o},e.autoRefresh&&a.refresh(),a}}),a("visualcaptcha/xhr-request",[],function(){"use strict";var e=window.XMLHttpRequest;return function(t,a){var n=new e;n.open("GET",t,!0),n.onreadystatechange=function(){var e;4===n.readyState&&200===n.status&&(e=JSON.parse(n.responseText),a(e))},n.send()}}),a("visualcaptcha/config",["visualcaptcha/xhr-request"],function(e){"use strict";return function(t){var a=window.location.href.split("/");a[a.length-1]="";var n={request:e,url:a.join("/").slice(0,-1),namespace:"",namespaceFieldName:"namespace",routes:{start:"/start",image:"/image",audio:"/audio"},isLoading:!1,hasLoaded:!1,autoRefresh:!0,numberOfImages:6,randomNonce:"",randomParam:"r",audioFieldName:"",imageFieldName:"",imageName:"",imageValues:[],callbacks:{},_loading:function(){},_loaded:function(){}};return n.applyRandomNonce=function(){return n.randomNonce=Math.random().toString(36).substring(2)},t.request&&(n.request=t.request),t.url&&(n.url=t.url),t.namespace&&(n.namespace=t.namespace),t.namespaceFieldName&&(n.namespaceFieldName=t.namespaceFieldName),void 0!==t.autoRefresh&&(n.autoRefresh=t.autoRefresh),t.numberOfImages&&(n.numberOfImages=t.numberOfImages),t.routes&&(t.routes.start&&(n.routes.start=t.routes.start),t.routes.image&&(n.routes.image=t.routes.image),t.routes.audio&&(n.routes.audio=t.routes.audio)),t.randomParam&&(n.randomParam=t.randomParam),t.callbacks&&(t.callbacks.loading&&(n.callbacks.loading=t.callbacks.loading),t.callbacks.loaded&&(n.callbacks.loaded=t.callbacks.loaded)),t._loading&&(n._loading=t._loading),t._loaded&&(n._loaded=t._loaded),n}}),a("visualcaptcha",["require","visualcaptcha/core","visualcaptcha/config"],function(e){"use strict";var t=e("visualcaptcha/core"),a=e("visualcaptcha/config");return function(e){return e=e||{},t(a(e))}}),a("visualcaptcha/deep-extend",[],function(){"use strict";var e;return e=function(t,a){t=t||{};for(var n in a)a[n]&&a[n].constructor&&a[n].constructor===Object?(t[n]=t[n]||{},e(t[n],a[n])):t[n]=a[n];return t}}),a("visualcaptcha/helpers",[],function(){"use strict";var e,t,a,n,i,r,s;return e=function(e,t){return t?e[0]:Array.prototype.slice.call(e)},t=function(t,a,n){var i=t.getElementsByClassName(a);return e(i,n)},a=function(t,a,n){var i=t.getElementsByTagName(a);return e(i,n)},n=function(e,t){var a=new RegExp("(\\s|^)"+t+"(\\s|$)");return e.className&&a.test(e.className)},i=function(e,t){if(Array.isArray(e))for(var a=0;a<e.length;a++)i(e[a],t);else n(e,t)||(e.className.length>0?e.className+=" "+t:e.className=t)},r=function(e,t){var a;if(Array.isArray(e))for(var n=0;n<e.length;n++)r(e[n],t);else a=new RegExp("(\\s|^)"+t+"(\\s|$)"),e.className=e.className.replace(a," ").replace(/(^\s*)|(\s*$)/g,"")},s=function(e,t){if(Array.isArray(e))for(var a=0;a<e.length;a++)s(e[a],t);else e.addEventListener?e.addEventListener("click",t,!1):e.attachEvent("onclick",t)},{findByClass:t,findByTag:a,hasClass:n,addClass:i,removeClass:r,bindClick:s}}),a("visualcaptcha/templates",[],function(){"use strict";var e,t,a,n,i,r,s;return e=function(e,t){for(var a in t)e=e.replace(new RegExp("{"+a+"}","g"),t[a]);return e},t=function(t,a,n){var i;return'<div class="visualCaptcha-accessibility-button"><a href="#"><img src="{path}accessibility{retinaExtra}.png" title="{accessibilityTitle}" alt="{accessibilityAlt}" /></a></div>','<div class="visualCaptcha-refresh-button"><a class="btn blue" href="#" title="{refreshTitle}" alt="{refreshAlt}"><i class="fas fa-sync"></i></a></div>',"",i={path:n||"",refreshTitle:a.refreshTitle,refreshAlt:a.refreshAlt,accessibilityTitle:a.accessibilityTitle,accessibilityAlt:a.accessibilityAlt,retinaExtra:t.isRetina()?"@2x":""},e("",i)},a=function(t,a){var n,i;return t.supportsAudio()?(n='<div class="visualCaptcha-accessibility-wrapper visualCaptcha-hide"><div class="accessibility-description">{accessibilityDescription}</div><audio preload="preload"><source src="{audioURL}" type="audio/ogg" /><source src="{audioURL}" type="audio/mpeg" /></audio></div>',i={accessibilityDescription:a.accessibilityDescription,audioURL:t.audioUrl(),audioFieldName:t.audioFieldName()},e(n,i)):""},n=function(t,a){for(var n,i,r="",s=0,o=t.numberOfImages();s<o;s++)n='<div class="img"><a href="#"><img src="{imageUrl}" id="visualCaptcha-img-{i}" data-index="{i}" alt="" title="" /></a></div>',i={imageUrl:t.imageUrl(s),i:s},r+=e(n,i);return n='<p class="visualCaptcha-explanation">{explanation}</p><div class="visualCaptcha-possibilities">{images}</div>',i={imageFieldName:t.imageFieldName(),explanation:a.explanation.replace(/ANSWER/,t.imageName()),images:r},e(n,i)},i=function(t){var a,n;return a='<input class="form-control audioField" type="text" name="{audioFieldName}" value="" autocomplete="off" />',n={audioFieldName:t.audioFieldName()},e(a,n)},r=function(t,a){var n,i;return n='<input class="form-control imageField" type="hidden" name="{imageFieldName}" value="{value}" readonly="readonly" />',i={imageFieldName:t.imageFieldName(),value:t.imageValue(a)},e(n,i)},s=function(t){var a,n,i=t.namespace();return i&&0!==i.length?(a='<input type="hidden" name="{fieldName}" value="{value}" />',n={fieldName:t.namespaceFieldName(),value:i},e(a,n)):""},{buttons:t,accessibility:a,images:n,audioInput:i,imageInput:r,namespaceInput:s}}),a("visualcaptcha/language",[],function(){"use strict";return{accessibilityAlt:"Sound icon",accessibilityTitle:"Accessibility option: listen to a question and answer it!",accessibilityDescription:"Type below the <strong>answer</strong> to what you hear. Numbers or words:",explanation:"<strong>ANSWER</strong>",refreshAlt:"Refresh/reload icon",refreshTitle:"Refresh/reload images!"}}),a("visualcaptcha.vanilla",["visualcaptcha","visualcaptcha/deep-extend","visualcaptcha/helpers","visualcaptcha/templates","visualcaptcha/language"],function(e,t,a,n,i){"use strict";var r,s,o,l;return r=function(){},s=function(e,t){var i,r,s=e.config;i=n.namespaceInput(t)+n.accessibility(t,s.language)+n.images(t,s.language)+n.buttons(t,s.language,s.imgPath),e.innerHTML=i,r=a.findByClass(e,"visualCaptcha-possibilities",!0),a.bindClick(a.findByClass(r,"img"),o.bind(null,e,t))},function(e,t){var i,r,s,o,l=a.findByClass(e,"visualCaptcha-accessibility-wrapper",!0),c=a.findByClass(e,"visualCaptcha-possibilities",!0),u=a.findByClass(e,"visualCaptcha-explanation",!0),d=a.findByTag(l,"audio",!0);a.hasClass(l,"visualCaptcha-hide")?(a.addClass(c,"visualCaptcha-hide"),a.addClass(u,"visualCaptcha-hide"),i=a.findByClass(c,"img"),a.removeClass(i,"visualCaptcha-selected"),void 0!==(r=a.findByTag(u,"input",!0))&&(r.value=""),o=n.audioInput(t),l.innerHTML=l.innerHTML.replace("<audio",o+"<audio"),a.removeClass(l,"visualCaptcha-hide"),d.load(),d.play()):(d.pause(),a.addClass(l,"visualCaptcha-hide"),s=a.findByTag(l,"input",!0),l.removeChild(s),a.removeClass(u,"visualCaptcha-hide"),a.removeClass(c,"visualCaptcha-hide"))},o=function(e,t,i){var r,s,o,l,c,u=i.currentTarget,d=a.findByClass(e,"visualCaptcha-possibilities",!0),m=a.findByClass(e,"visualCaptcha-explanation",!0);(l=a.findByTag(m,"input",!0))&&(m.removeChild(l),s=a.findByClass(d,"img"),a.removeClass(s,"visualCaptcha-selected")),a.addClass(u,"visualCaptcha-selected"),r=a.findByTag(u,"img",!0),o=parseInt(r.getAttribute("data-index"),10),c=n.imageInput(t,o),m.innerHTML+=c},function(e,t){t.refresh()},l=function(e){var t=a.findByClass(e,"imageField",!0)||{},n=a.findByClass(e,"audioField",!0)||{},i=!(!t.value&&!n.value);return i?{valid:i,name:t.value?t.name:n.name,value:t.value?t.value:n.value}:{valid:i}},function(n,o){var c,u,d;return c=t({imgPath:"/",language:i,captcha:{}},o),n="string"==typeof n?document.getElementById(n):n,n.config=c,a.addClass(n,"visualCaptcha"),d=t(c.captcha,{_loading:r.bind(null,n),_loaded:s.bind(null,n)}),void 0!==n.getAttribute("data-namespace")&&(d.namespace=n.getAttribute("data-namespace")),u=e(d),u.getCaptchaData=l.bind(null,n),"function"==typeof c.init&&c.init.call(null,u),u}}),t("visualcaptcha.vanilla")}),document.body.classList.remove("no-js");var http=function(){this.toParam=function(e){var t=[];for(var a in e)t.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return t.join("&")},this.fromParam=function(e){return JSON.parse('{"'+decodeURI(e).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')},this.get=function(e,t){var a=this.toParam(e.data),n=new XMLHttpRequest;if(n.onreadystatechange=function(){4==n.readyState&&200==n.status&&t(n.responseText)},n.open("GET",e.url+"?"+a,!0),void 0!==e.headers)for(var i in e.headers)e.headers.hasOwnProperty(i)&&n.setRequestHeader(i,e.headers[i]);return n.send(null),n},this.post=function(e,t){var a=!0;try{e.data.entries()}catch(e){a=!1}var n=new XMLHttpRequest;if(n.onreadystatechange=function(){4==n.readyState&&200==n.status&&t(n.responseText)},n.open("POST",e.url,!0),void 0!==e.headers)for(var i in e.headers)e.headers.hasOwnProperty(i)&&n.setRequestHeader(i,e.headers[i]);if(a)n.send(e.data);else{var r=this.toParam(e.data);n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send(r)}return n}},timeyWimey=function(e){this.container=void 0===e?document:e,this.init=function(){for(var e=this.container.querySelectorAll("[data-moment]"),t=0;t<e.length;t++){var a=e[t];this.format(a.dataset.moment,a)}},this.format=function(e,t){var a=t.dataset.format,n=t.dataset.time;switch(e){case"epoch":"fromnow"===a&&this.replace(moment.unix(parseInt(n)).format("MMMM Do YYYY, h:mm:ss A"),moment.unix(parseInt(n)).fromNow(),t)}},this.replace=function(e,t,a){a.setAttribute("title",e),a.textContent=t}},Autocomplete=function(e){var t=e.getElementsByTagName("input")[0],a=e.getElementsByTagName("ul")[0];this.init=function(){t.addEventListener("input",debounce(this.query.bind(this),300)),a.addEventListener("click",function(e){if(e.target&&void 0!==e.target.dataset.gameId){var n=e.target.dataset.gameId;t.value=n,a.innerHTML=""}})},this.query=function(){var e=this.updateList.bind(this),n=null;null!==n&&n.abort(),""!==t.value.trim()&&(a.innerHTML="",n=http.get({url:"/api/autocomplete",data:{term:t.value}},function(t){"object"==typeof(t=JSON.parse(t))&&e(t.hits)}))},this.updateList=function(e){for(var t=0;t<e.length;t++){var n=e[t]._id,i=e[t]._source.name,r=document.createElement("li");r.dataset.gameId=n,r.textContent=i,a.appendChild(r)}}};new Clipboard("[data-clip-links-legacy]",{text:function(e){for(var t=e.parentNode.childNodes,a=[],n=0;n<t.length;n++){var i=t[n];"LI"===i.tagName&&a.push(i.getElementsByTagName("a")[0].getAttribute("href"))}return a.join("\n")}}),new Clipboard("[data-clip-links]",{text:function(e){for(var t=e.nextElementSibling.nextElementSibling.nextElementSibling.querySelectorAll("a.item"),a=[],n=0;n<t.length;n++){var i=t[n];a.push(i.href)}return a.join("\n")}}),new Headroom(document.getElementById("navigation")).init(),new Headroom(document.getElementById("navigation-mobile")).init();var http=new http,time=new timeyWimey;time.init(),document.addEventListener("click",function(e){if(e.target&&("openBatch"in e.target.dataset||"openBatch"in e.target.parentNode.dataset)){var t=e.target.parentNode.parentNode.getElementsByTagName("a");"new"===e.target.dataset.openBatch&&(t=e.target.nextElementSibling.nextElementSibling.querySelectorAll("a.item"));for(var a=[],n=0;n<t.length;n++)a.push(t[n].href);for(var i=0,n=0;n<a.length;n++)navigator.userAgent.toLowerCase().indexOf("firefox")>-1?function(e){setTimeout(function(){var t=document.createElement("a");t.download="",t.href=a[e],t.target="_blank",t.dispatchEvent(new MouseEvent("click"))},100*++i)}(n):function(e){setTimeout(function(){window.open(a[e],"_blank")},1e3)}(n)}},!1);var searchBtn=document.getElementById("search-btn"),searchResults=document.getElementById("search-results"),innerResults=searchResults.querySelector(".inner"),currentSearch=null,search=debounce(function(){null!==currentSearch&&currentSearch.abort(),""!==this.value.trim()&&(currentSearch=http.get({url:"/api/autocomplete",data:{term:this.value}},function(e){e=JSON.parse(e),"show"!==searchResults.classList.value&&toggleSearch(),innerResults.innerHTML="";for(var t=0;t<e.hits.length;t++){var a=e.hits[t]._source,n=document.getElementById("tpl-search").innerHTML,i=Mustache.render(n,{gameSlug:a.slug,gameName:a.name});innerResults.innerHTML+=i}}))},300);document.querySelector("#search-bar input").addEventListener("input",search),document.querySelector("#search-bar").addEventListener("submit",function(e){e.preventDefault();var t=this.querySelector("input").value;window.location.href="/search/"+encodeURIComponent(t)});for(var elHideSearch=document.querySelectorAll("[data-hide-autocomplete]"),i=0;i<elHideSearch.length;i++)elHideSearch[i].addEventListener("click",toggleSearch);document.addEventListener("click",function(e){e.target&&"nfo"in e.target.dataset&&showNFO(e.target.dataset.nfo,"desktop"),e.target&&"nfoMobile"in e.target.dataset&&showNFO(e.target.dataset.nfoMobile,"mobile"),e.target&&"nfomobile"in e.target.dataset&&showNFOMobile(e.target)}),document.addEventListener("change",function(e){e.target&&e.target.classList.contains("modal-state")&&toggleScroll()}),document.addEventListener("click",function(e){if(e.target&&e.target.classList.contains("modal-calc-height")&&"LABEL"===e.target.tagName){for(var t=document.getElementById(e.target.getAttribute("for")).nextElementSibling.getElementsByClassName("modal__inner")[0],a=0,n=0;n<t.childNodes.length;n++){var i=t.childNodes[n].offsetHeight;isNaN(i)||(a+=i)}t.style.maxHeight=a+"px"}}),document.addEventListener("click",function(e){if(e.target&&e.target.classList.contains("edit-btn")){toggleScroll(),document.getElementById("modal-editgame").checked=!0;var t=document.getElementById("tpl-editgame").innerHTML,a=document.querySelector("#modal-editgame + .modal .editgame-container"),n=e.target.dataset.gameId;a.innerHTML="",http.get({url:"/admin/ajax/game",data:{gameId:n},headers:{"X-Api-Key":__APIKEY}},function(e){var n=JSON.parse(e);n.MSG.renderDate=function(){return function(e,t){return moment.unix(parseInt(t(e))).format("YYYY-MM-DD")}},n.MSG.ifselected=function(){return function(e,t){var a=t(e);if((a=JSON.parse(a)).status===a.value)return"selected"}};var i=Mustache.render(t,n.MSG);i=document.createRange().createContextualFragment(i),a.appendChild(i),new Autocomplete(a.querySelector(".game-autocomplete")).init()})}if(e.target&&e.target.classList.contains("links-delete-batch")){e.preventDefault();for(var i=new FormData,r=e.target.closest(".links").querySelectorAll("input.link-check:checked"),s=0;s<r.length;s++){var o=r[s].value;i.append("linkIds[]",o)}http.post({url:"/api/release/scene/links/remove",data:i,headers:{"X-Api-Key":__APIKEY}},function(e){if((e=JSON.parse(e)).SUCCESS)for(var t=0;t<r.length;t++)r[t].parentNode.parentNode.parentNode.removeChild(r[t].parentNode.parentNode)})}if(e.target&&e.target.classList.contains("form-images-edit-tgdb")){e.preventDefault();var l=e.target.dataset.gameName,c=e.target.dataset.searchType;http.post({url:"/admin/ajax/tgdb_proxy",data:{name:l},headers:{"X-Api-Key":__APIKEY}},function(e){e=JSON.parse(e);var t,a="";"poster"===c?t=e.posters:"background"===c&&(t=e.backgrounds);for(var n=0;n<t.length;n++)a+='<img src="'+e.base+t[n]+'">';document.getElementById("tgdb-selector-container").innerHTML=a})}}),document.addEventListener("change",function(e){if(e.target&&e.target.classList.contains("releases-select-all"))for(var t=e.target.closest(".releases").querySelectorAll("input.release-check"),a=0;a<t.length;a++)e.target.checked?t[a].checked=!0:t[a].checked=!1;if(e.target&&e.target.classList.contains("links-select-all"))for(var t=e.target.closest(".links").querySelectorAll("input.link-check"),a=0;a<t.length;a++)e.target.checked?t[a].checked=!0:t[a].checked=!1;if(e.target&&e.target.classList.contains("releases-batch-action")){var n=e.target.parentNode.getElementsByClassName("game-autocomplete")[0];"move"===e.target.value?n.classList.remove("hidden"):n.classList.add("hidden")}}),document.addEventListener("submit",function(e){if(e.target&&e.target.classList.contains("form-game-edit")){e.preventDefault();var t=new FormData(e.target);http.post({url:"/admin/ajax/game",data:t,headers:{"X-Api-Key":__APIKEY}},function(e){(e=JSON.parse(e)).SUCCESS?window.alert("Success!"):window.alert(e.MSG)})}if(e.target&&e.target.classList.contains("form-images-edit")){e.preventDefault();var a=new FormData(e.target);http.post({url:"/admin/ajax/game",data:a,headers:{"X-Api-Key":__APIKEY}},function(e){(e=JSON.parse(e)).SUCCESS?window.alert("Successfully Saved!"):window.alert(e.MSG)})}if(e.target&&e.target.classList.contains("form-release-edit")){e.preventDefault();var n=new FormData(e.target);http.post({url:"/admin/ajax/game",data:n,headers:{"X-Api-Key":__APIKEY}},function(e){(e=JSON.parse(e)).SUCCESS?window.alert("Success!"):window.alert(e.MSG)})}if(e.target&&e.target.classList.contains("form-release-editnfo")){e.preventDefault();var i=new FormData(e.target);http.post({url:"/api/nfo/add",data:i,headers:{"X-Api-Key":__APIKEY}},function(e){(e=JSON.parse(e)).SUCCESS?window.alert("Success!"):window.alert(e.MSG)})}if(e.target&&e.target.classList.contains("form-release-editlink")){e.preventDefault();var r=new FormData(e.target);http.post({url:"/api/release/scene/links/update",data:r,headers:{"X-Api-Key":__APIKEY}},function(e){(e=JSON.parse(e)).SUCCESS?window.alert("Success!"):window.alert(e.MSG)})}if(e.target&&e.target.classList.contains("releases-batch-edit")){e.preventDefault();for(var s=new FormData(e.target),o=e.target.closest(".releases").querySelectorAll("input.release-check:checked"),l=0;l<o.length;l++){var c=o[l].value;s.append("releaseIds[]",c)}var u;switch(s.get("action")){case"move":u="/api/release/move";break;case"delete":var d="releases";if(1===o.length&&(d="release"),!confirm("Are you sure you want to delete "+o.length+" "+d+"?"))return;u="/api/release/delete"}http.post({url:u,data:s,headers:{"X-Api-Key":__APIKEY}},function(e){if((e=JSON.parse(e)).SUCCESS)for(var t=0;t<o.length;t++)o[t].parentNode.parentNode.parentNode.removeChild(o[t].parentNode.parentNode)})}}),document.addEventListener("click",function(e){if(e.target&&e.target.classList.contains("links-modal-trigger")){var t=document.querySelector("#"+e.target.getAttribute("for")+" + .modal");http.get({url:"/getlinks/",data:{id:e.target.dataset.id}},function(e){t.getElementsByClassName("links-loading")[0].classList.add("hidden"),t.getElementsByClassName("links-block")[0].innerHTML=e})}});var captcha;document.addEventListener("click",function(e){if(e.target&&e.target.matches(".__vote-modal-trigger")){e.stopPropagation(),e.preventDefault(),toggleScroll();var t=parseInt(e.target.dataset.id);voteBtn.classList.add("hidden"),document.getElementById("vote-captcha-message").classList.add("hidden"),document.getElementById("vote-captcha").classList.remove("hidden"),document.getElementById("vote-captcha-success").classList.add("hidden"),captcha=visualCaptcha("vote-captcha",{captcha:{numberOfImages:9,url:window.location.origin+"/api/captcha",randomParam:"what-are-you-looking-at",routes:{start:"/begin",image:"/img"},callbacks:{loaded:function(a){document.getElementById("modal-captcha").checked=!0,a.releaseId=t,a.voteTrigger=e.target;var n=document.getElementById("vote-captcha").getElementsByClassName("img");Array.prototype.slice.call(n).forEach(function(e){e.addEventListener("click",function(e){e.preventDefault(),voteBtn.classList.remove("hidden")},!1)})}}}})}},!1);var voteBtn=document.getElementsByClassName("__vote")[0];voteBtn.addEventListener("click",function(e){e.preventDefault();var t=captcha.getCaptchaData();if(t.valid){var a=captcha.imageFieldName(),n=t.value,i={rls_id:captcha.releaseId};i[a]=n;var r=document.getElementById("vote-captcha-message"),s=document.getElementById("vote-captcha-success");http.post({url:"/api/captcha/vote",data:i},function(e){var t=JSON.parse(e);t.SUCCESS?(captcha.voteTrigger.classList.add("hidden"),document.getElementById("vote-captcha").classList.add("hidden"),s.classList.remove("hidden"),voteBtn.classList.add("hidden"),r.classList.add("hidden")):(captcha.refresh(),s.classList.add("hidden"),voteBtn.classList.add("hidden"),r.classList.remove("hidden"),r.classList.add("txt-red"),r.innerText=t.MSG)})}},!1);